{"ast":null,"code":"import apiFetch from \"@/common/api.service\";\nimport interraction from \"./interraction-script.vue\";\nimport buttonValidation from \"@/components/interraction/buttons/validation-button.vue\";\nexport default {\n  name: 'script-create',\n  components: {\n    interraction,\n    buttonValidation\n  },\n  data() {\n    return {\n      step: {\n        name: '',\n        server: {\n          id: null\n        },\n        container: {\n          id: null\n        },\n        script: {\n          id: null\n        },\n        inputs: []\n      },\n      oldStep: {},\n      req: {\n        scripts: [],\n        servers: []\n      },\n      selectContainer: false,\n      containersSelect: []\n    };\n  },\n  watch: {\n    'step.server'() {\n      try {\n        if (this.step.server) {\n          let server = this.req.servers.filter(server => server.id === this.step.server);\n          this.containersSelect = server[0].containers;\n          this.step.container = null;\n          if (this.containersSelect.length == 0) {\n            this.selectContainer = false;\n          }\n        }\n      } catch {\n        return;\n      }\n    },\n    selectContainer(newV, oldV) {\n      if (oldV == false && newV == true) {\n        console.log(\"here is the selected server\", this.step.server);\n        if (this.step.server == null) {\n          this.emitter.emit(\"sidebar-error\", {\n            error: true,\n            description: 'Please select a server first.'\n          });\n          this.selectContainer = false;\n        } else if (this.step.container == null) {\n          this.containersSelect = this.req.servers.filter(server => {\n            return server.id === this.step.server;\n          })[0].containers;\n        }\n      } else if (oldV == true && newV == false) {\n        this.step.container = null;\n        this.containersSelect = [];\n      }\n    },\n    'step.script.id'() {\n      if (this.script) {\n        let endpoint = '/incident/' + this.$route.params.id + '/script/' + this.step.script.id + '/join';\n        apiFetch.get(endpoint, false).then(inputs => {\n          this.step.inputs = inputs;\n        });\n      }\n    }\n  },\n  created() {\n    // incident/3/step/create\n\n    let endpoint = '/incident/' + this.$route.params.id + '/step/' + this.$route.params.stepID;\n    apiFetch.get(endpoint, false).then(req => {\n      console.log(\"step\", req);\n      this.step = req;\n      this.step.server = this.step.server.id;\n      this.step.script = this.step.script.id;\n      if (this.step.container) {\n        this.selectContainer = true;\n        this.step.container = this.step.container.id;\n      }\n      this.oldStep = Object.assign({}, this.step);\n    }).then(() => {\n      let endpoint2 = '/incident/' + this.$route.params.id + '/step/create';\n      apiFetch.get(endpoint2, false).then(req => {\n        this.req = req;\n        console.log(\"req\", this.req);\n      }).then(() => {\n        console.log(\"this.step.container\", this.step.container);\n        if (this.step.container) {\n          var containers = this.req.servers.filter(server => server.id === this.step.server);\n          this.containersSelect = containers[0].containers; // Fixed variable name here\n        }\n      });\n    });\n  },\n  methods: {\n    updateStep() {\n      let exclude = [\"id\", \"inputs\", \"container\"];\n      this.keepUpdatedValue(this.oldStep, this.step, exclude);\n      console.log(\"here is the step\", this.step);\n      let endpoint = '/incident/step/update';\n      apiFetch.update(endpoint, {\n        step: this.step.id,\n        server: this.step.server,\n        script: this.step.script,\n        container: this.step.container,\n        name: this.step.name,\n        inputs: this.step.inputs,\n        onServer: this.step.container == null ? true : false\n      }, true, false).then(() => {\n        this.$router.back();\n      });\n    },\n    keepUpdatedValue(oldObject, newObject, dontCheck) {\n      for (const prop of Object.getOwnPropertyNames(oldObject)) {\n        if (oldObject[prop] == newObject[prop] && !dontCheck.includes(prop)) {\n          newObject[prop] = null;\n        }\n      }\n    }\n  }\n};","map":{"version":3,"names":["apiFetch","interraction","buttonValidation","name","components","data","step","server","id","container","script","inputs","oldStep","req","scripts","servers","selectContainer","containersSelect","watch","step.server","filter","containers","length","newV","oldV","console","log","emitter","emit","error","description","step.script.id","endpoint","$route","params","get","then","created","stepID","Object","assign","endpoint2","methods","updateStep","exclude","keepUpdatedValue","update","onServer","$router","back","oldObject","newObject","dontCheck","prop","getOwnPropertyNames","includes"],"sources":["/Users/abdelmadjidbelhanafi/Documents/vsc project/prosolver/src/views/steps/edit.vue"],"sourcesContent":["<template>\n    <interraction :forbiddenInputs=\"false\" >\n        <template #ScriptHeader >Edit step {{ step.name }}</template>\n\n\n        <template #InputName >\n            <input  v-model=\"step.name\"  type=\"text\">\n        </template>\n        <template #InputScript >\n            <select  v-model=\"step.script\" >\n                <option v-for=\"script in req.scripts\" :key=\"script.id\" :value=\"script.id\">{{ script.name+'.'+script.language }}</option>\n            </select>\n        </template>\n        <template #InputServer >\n            <select  v-model=\"step.server\"  >\n                <option v-for=\"server in req.servers\" :key=\"server.id\" :value=\"server.id\">{{ server.name }}</option>\n            </select>\n        </template>\n        <template #InputContainerChekbox >\n            <input type=\"checkbox\" v-model=\"selectContainer\" name=\"\" id=\"\">\n        </template>\n        <template v-if=\"selectContainer\" #InputContainer >\n            <select  v-model=\"step.container\"  >\n                <option v-for=\"container in containersSelect\" :key=\"container.id\" :value=\"container.id\">{{ container.name}}</option>\n            </select>\n        </template>\n\n\n\n        <template #GlobalInputListing >\n            <div style=\"height: 100%;width: 100%;\" >\n                <div class=\"input-config-holder\" v-for=\"input,index in step.inputs\" :key=\"index\" >\n                    <div class=\"input-config-line\"   v-if=\"input.fromIncident\" >\n                        <p>Make <strong> {{ input.label +' ' }}</strong> input global.</p>\n                        <input type=\"checkbox\" v-model=\"input.fromIncident\">\n                    </div>\n                    <div class=\"input-config-line\"  v-else >\n                        <p>Local <strong> {{ input.label +' ' }} </strong> input.</p>\n                    </div>\n                    \n                </div>\n            </div>\n        </template>\n        <template #Footer >\n            <buttonValidation   @click=\"updateStep()\" :ok=\"true\" :type=\"'submit'\">\n                <template #textButton>\n                    Save changes\n                </template>\n            </buttonValidation>\n            <buttonValidation   @click=\"$router.back()\" :danger=\"true\" :type=\"'submit'\">\n                <template #textButton>\n                    Cancel\n                </template>\n            </buttonValidation>\n\n        </template> \n\n        <template #popUps >\n            \n        </template>\n\n    </interraction>\n</template>\n<script>\nimport apiFetch from \"@/common/api.service\"\nimport interraction from \"./interraction-script.vue\"\nimport buttonValidation from \"@/components/interraction/buttons/validation-button.vue\"\nexport default{\n    name : 'script-create',\n    components : {\n        interraction,\n        buttonValidation\n    },\n    data(){\n        return{\n            step : {\n                name : '',\n                server : {\n                    id : null\n                } ,\n                container : {\n                    id : null\n                },\n                script : {\n                    id : null\n                },\n                inputs : []\n            },\n            oldStep :{},\n            req : {\n                scripts : [],\n                servers : [],\n            },\n            selectContainer : false,\n            containersSelect : []\n        }\n    },\n    watch : {\n        'step.server'(){\n            try{\n                if(this.step.server){\n                    let server = this.req.servers.filter( server => server.id === this.step.server );\n                    this.containersSelect =  server[0].containers;\n                    this.step.container = null;\n                    if(this.containersSelect.length == 0 ){\n                        this.selectContainer = false;\n                    }\n                }\n            }catch{\n                return;\n            }\n            \n        },\n        selectContainer(newV,oldV){\n            if(oldV == false && newV == true){\n                console.log(\"here is the selected server\",this.step.server)\n                if(this.step.server == null){\n                    this.emitter.emit(\"sidebar-error\",{error : true , description : 'Please select a server first.'})\n                    this.selectContainer = false;\n                }else if(this.step.container == null ){\n                    this.containersSelect = this.req.servers.filter(server =>{ return server.id === this.step.server;})[0].containers;\n                }\n            }else if(oldV == true && newV == false){\n                this.step.container = null;\n                this.containersSelect = [];\n            }\n        },\n        'step.script.id'(){\n            if(this.script){\n                let endpoint = '/incident/' + this.$route.params.id + '/script/' + this.step.script.id + '/join'\n                apiFetch.get(endpoint, false)\n                    .then((inputs) => {\n                        this.step.inputs = inputs\n\n                    })\n            }\n        }\n\n    },\n    created(){\n        // incident/3/step/create\n\n        let endpoint = '/incident/'+ this.$route.params.id+'/step/'+this.$route.params.stepID\n        apiFetch.get(endpoint,false)\n        .then((req)=>{\n            console.log(\"step\",req)\n            this.step= req;\n            this.step.server = this.step.server.id; \n            this.step.script = this.step.script.id; \n            if(this.step.container){\n                this.selectContainer= true;\n                this.step.container = this.step.container.id\n            }\n            this.oldStep =Object.assign({}, this.step); \n        })\n        .then(()=>{\n            let endpoint2 = '/incident/'+ this.$route.params.id+'/step/create'\n            apiFetch.get(endpoint2, false)\n            .then((req) => {\n                this.req = req;\n                console.log(\"req\",this.req)\n            })\n            .then(()=>{\n                console.log(\"this.step.container\",this.step.container)\n                    if (this.step.container) {\n                        var containers = this.req.servers.filter(server => server.id === this.step.server);\n                        this.containersSelect = containers[0].containers; // Fixed variable name here\n                    }\n            })\n        })\n\n\n    },\n    methods : {\n        updateStep(){\n            let exclude = [\"id\",\"inputs\",\"container\"];\n            \n            this.keepUpdatedValue(this.oldStep,this.step,exclude);\n            console.log(\"here is the step\",this.step)\n            let endpoint = '/incident/step/update';\n            apiFetch.update(endpoint,{\n                step : this.step.id,\n                server : this.step.server,\n                script : this.step.script,\n                container : this.step.container,\n                name : this.step.name,\n                inputs : this.step.inputs,\n                onServer : this.step.container == null ? true : false\n            },\n            true,\n            false)\n            .then(()=>{\n                this.$router.back()\n            })\n\n        },\n        keepUpdatedValue(oldObject, newObject, dontCheck) {\n            for (const prop of Object.getOwnPropertyNames(oldObject)) {\n                if (oldObject[prop] == newObject[prop] && !(dontCheck.includes(prop))) {\n                    newObject[prop] = null;\n                }\n            }\n        },\n    }\n}\n</script>\n<style scoped>\n.input-config-holder{\n    display: flex;\n    flex-direction: column;\n    align-items: flex-start;\n    justify-content: flex-start;\n\n    gap: 5px;\n    box-sizing: border-box;\n\n    overflow-y: auto;\n\n    width: 100%;\n\n\n}\n.input-config-line{\n\n    width: 100%;\n\n    padding: var(--extra-small-padding);\n    box-sizing: border-box;\n\n    border: solid 1px black;\n    border-radius: 3px;\n\n    background-color: white;\n\n    display: flex;\n    justify-content: flex-start;\n    align-items: center;\n\n    gap:3px;\n\n    margin-top: 5px;\n}\n.input-config-line:hover{\n    border: solid 1px var(--warm-color-1);\n}\n\n\n</style>"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}