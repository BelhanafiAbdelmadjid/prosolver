{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\nimport apiFetch from \"@/common/api.service.js\";\nimport { UseAuthStore } from \"@/store/store.js\";\nimport lineComponent from \"@/components/incident-execute/step-lines.vue\";\nimport buttonValidation from \"@/components/interraction/buttons/validation-button.vue\";\nimport lineShell from \"@/components/incident-execute/shellline.vue\";\nexport default {\n  name: 'incident-execute',\n  data() {\n    return {\n      AuthStore: UseAuthStore(),\n      incident: {},\n      openBooleans: {},\n      notWaitingForOutPut: true\n    };\n  },\n  methods: {\n    lookForGlobalInput(input) {\n      let res = this.incident.inputs.find(item => item.id === input.parentInput);\n      input.value = res.value;\n      return res;\n    },\n    async fillShell(cmd, step) {\n      if (cmd == 'clear') {\n        step.shell = [{\n          command: 'clear'\n        }];\n      } else if (cmd == 'exec' || cmd == 'execute') {\n        await this.executeStep(step);\n      } else {\n        step.shell.push({\n          command: cmd,\n          result: [{\n            value: \"Command: '\" + cmd + \"' not found please contact your support.\",\n            type: 'warning'\n          }]\n        });\n      }\n    },\n    async executeStep(step) {\n      if (this.notWaitingForOutPut != false) {\n        this.notWaitingForOutPut = false;\n        let endpoint = '/incident/step/execute';\n        await apiFetch.post(endpoint, {\n          id: step.id,\n          inputs: step.inputs\n        }, true, false).then(res => {\n          console.log('result execution', res);\n          let allRes = [];\n          for (let line of res.error) {\n            allRes.push({\n              value: line,\n              type: 'correct'\n            });\n          }\n          for (let line of res.result) {\n            allRes.push({\n              value: line,\n              type: 'correct'\n            });\n          }\n          step.shell.push({\n            command: 'execute',\n            result: [...allRes]\n          });\n          this.notWaitingForOutPut = true;\n        });\n      } else {\n        this.emitter.emit(\"sidebar-error\", {\n          error: true,\n          description: 'Please wait, a step is already being executed.'\n        });\n      }\n    },\n    async excuteStepButton(step) {\n      await this.executeStep(step);\n    }\n  },\n  components: {\n    lineComponent,\n    buttonValidation,\n    lineShell\n  },\n  beforeMount() {\n    let endpoint = \"/incident/\" + this.$route.params.id;\n    apiFetch.get(endpoint, true, false).then(incident => {\n      this.incident = incident;\n      for (let step of this.incident.steps) {\n        step.shell = [];\n      }\n      console.log(this.incident.steps);\n    });\n  }\n};","map":{"version":3,"names":["apiFetch","UseAuthStore","lineComponent","buttonValidation","lineShell","name","data","AuthStore","incident","openBooleans","notWaitingForOutPut","methods","lookForGlobalInput","input","res","inputs","find","item","id","parentInput","value","fillShell","cmd","step","shell","command","executeStep","push","result","type","endpoint","post","then","console","log","allRes","line","error","emitter","emit","description","excuteStepButton","components","beforeMount","$route","params","get","steps"],"sources":["/Users/abdelmadjidbelhanafi/Documents/vsc project/Natixis/new-banxy-rest-api/frontend/src/views/incidents/execute.vue"],"sourcesContent":["<template>\n    <div class=\"holders execution-holder\">\n        <div class=\"header colorfull-gradient-1\">\n            Executing incident\n        </div>\n        <div\n            style=\"box-sizing:border-box; padding: 10px; background-color:rgb(240, 240, 240); border-radius: 10px; display:grid;grid-template-rows:auto; gap:10px;\">\n            <p>\n                <strong>Global inputs </strong>\n            </p>\n            <div class=\"input-holders\"\n                style=\"padding:0px;display: flex;flex-direction: row;justify-content: flex-start;align-items :center; gap:5px;\"\n                v-for=\"npt,index in incident.inputs\" :key=\"index\">\n                <label>{{ npt.label }}</label>\n                <input :placeholder=\"npt.label\" :type=\"npt.type\" v-model=\"npt.value\" required>\n            </div>\n        </div>\n        <div class=\"steps\">\n            <lineComponent v-for=\"step in incident.steps\" :key=\"step.id\">\n\n                <template #Header>{{'Step '+step.order + \": \" +step.name }}</template>\n                <template #content>\n                    <form @submit.prevent=\"excuteStepButton(step)\" >\n                        <div class=\"step-left-side\">\n                            <div class=\"step-inputs\">\n                                <div v-for=\"input in step.inputs\" :key=\"input.id\" class=\"input-holder\"\n                                    style=\" background-color: white; display: flex;flex-direction: column;justify-content: flex-start;align-items :flex-start; gap:5px;box-sizing: border-box;\">\n                                    <label for=\"type\" >{{ input.label }}: </label>\n\n                                    <input v-if=\"!input.fromIncident\"   style=\"width: 100%;\" :placeholder=\"input.label\" :type=\"input.type\" v-model=\"input.value\" required >\n                                    <input v-else @reset=\"\"  :required=\"true\"  :placeholder=\"input.label\" style=\"width: 100%;\" :type=\"input.type\" v-model=\"lookForGlobalInput(input).value\"  disabled >\n                                </div>\n\n                            </div>\n                            <div class=\"step-footer colorfull-gradient-1\">\n                                <p>\n                                    Executing <strong>{{\" \"+ step.script.name + ' ' }}</strong> on {{ (step.onServer ==\n                                    true ? step.server.name : step.container.name + ' container of ' + step.server.name\n                                    ) }}\n                                </p>\n                                <div class=\"shell-buttons\">\n                                    <buttonValidation style=\"width: 100%;padding:0;\" :warning=\"true\" :type=\"'Reset'\">\n                                        <template #textButton>\n                                            Reset\n                                        </template>\n                                    </buttonValidation>\n                                    <buttonValidation  style=\"width: 100%;padding:0;\" :ok=\"true\" :type=\"'Submit'\">\n                                        <template #textButton>\n                                            Execute\n                                        </template>\n                                    </buttonValidation>\n\n                                </div>\n                            </div>\n                        </div>\n                    </form>\n                    <div class=\"step-shell\" style=\"background-color: black;\">\n                            <lineShell \n                            v-for=\"line,index in step.shell\" :key=\"index\"\n                            :last=\"false\"\n                            :username=\"AuthStore.getUsername\"\n                            :server=\"step.server.name\"\n                            :command=\"line.command\"\n                            :result=\"line.result\"\n                            :notWaitingForOutPut=\"notWaitingForOutPut\"\n                            > </lineShell>\n                            \n                            <lineShell \n                            :last=\"true\"\n                            :username=\"AuthStore.getUsername\"\n                            :server=\"step.server.name\"\n                            :notWaitingForOutPut=\"notWaitingForOutPut\"\n                            :validCommands=\"['clear']\"\n                            @fill-shell=\"(cmd)=>{fillShell(cmd,step)}\"\n                            > </lineShell>\n                    </div>\n                </template>\n\n            </lineComponent>\n        </div>\n    </div>\n</template>\n\n<script>\nimport apiFetch from \"@/common/api.service.js\"\nimport { UseAuthStore } from \"@/store/store.js\"\n\nimport lineComponent from \"@/components/incident-execute/step-lines.vue\"\nimport buttonValidation from \"@/components/interraction/buttons/validation-button.vue\"\nimport lineShell from \"@/components/incident-execute/shellline.vue\"\n\nexport default{\n    name : 'incident-execute',\n    data(){\n        return {\n            AuthStore : UseAuthStore(),\n            incident: {\n\n            },\n            openBooleans : {},\n            notWaitingForOutPut : true,\n        }\n    },\n    methods : {\n        lookForGlobalInput(input){\n            let res = this.incident.inputs.find(item => item.id === input.parentInput);\n            input.value = res.value;\n            return res;\n        },\n        async fillShell(cmd,step){\n            if (cmd == 'clear') {\n                step.shell = [{ command: 'clear' }]\n            } else if (cmd == 'exec' || cmd == 'execute') {\n                await this.executeStep(step)\n            } else {\n                step.shell.push({\n                    command: cmd,\n                    result: [\n                        {\n                            value: \"Command: '\" + cmd + \"' not found please contact your support.\",\n                            type: 'warning'\n                        }\n                    ]\n                })\n            }\n        },\n        async executeStep(step){\n            if(this.notWaitingForOutPut != false){\n                this.notWaitingForOutPut = false;\n            let endpoint = '/incident/step/execute'\n            await apiFetch.post(endpoint,{\n                id : step.id,\n                inputs : step.inputs,\n            },true,false)\n            .then((res)=>{\n                console.log('result execution', res)\n                let allRes = []\n                for(let line of res.error){\n                    allRes.push({\n                        value : line,\n                        type : 'correct'\n                    })\n                }\n                for(let line of res.result){\n                    allRes.push({\n                        value : line ,\n                        type : 'correct'\n                    })\n                }\n                step.shell.push({\n                    command : 'execute',\n                    result : [...allRes]\n                })\n                this.notWaitingForOutPut = true;\n            })\n            }else{\n                this.emitter.emit(\"sidebar-error\",{\n                    error : true ,\n                    description : 'Please wait, a step is already being executed.'\n                })\n            }\n\n        },\n        async excuteStepButton(step){\n            await this.executeStep(step)\n        }\n    },\n    components : {\n        lineComponent,\n        buttonValidation,\n        lineShell\n    },\n    beforeMount(){\n        let endpoint = \"/incident/\"+ this.$route.params.id ;\n        apiFetch.get(endpoint,true,false)\n        .then((incident)=>{\n            this.incident = incident;\n            for(let step of this.incident.steps){\n                step.shell = [];\n            }\n            console.log(this.incident.steps)\n        })\n    }\n}\n</script>\n<style scoped>\n.execution-holder{\n    width: 100%;\n\n    display: grid;\n    grid-template-rows: auto auto 1fr;\n\n    \n    height: 100vh;\n    width: 100%;\n\n    padding: var(--small-padding);\n    box-sizing: border-box;\n\n    overflow-y: auto;\n\n\n}\n.execution-holder .header{\n    padding: 10px;\n    box-sizing: border-box;\n\n    font-size: 24px;\n    font-weight: 700;\n\n    color :white;\n}\n.execution-holder .steps{\n    display: flex;\n    flex-direction: column;\n    align-items: center;\n    justify-content: flex-start;\n\n    gap: 5px;\n\n    overflow-y: auto;\n\n    max-height: 100%;\n\n\n}\n\n.execution-holder .steps::-webkit-scrollbar {\n  width: 4px; /* Width of the scrollbar */\n}\n\n/* Handle portion of the scrollbar */\n.execution-holder .steps::-webkit-scrollbar-thumb {\n  background-color: #999; /* Color of the thumb */\n  border-radius: 4px; /* Border radius of the thumb */\n}\n\n/* Track (background) of the scrollbar */\n.execution-holder .steps::-webkit-scrollbar-track {\n  background-color: #f0f0f0; /* Color of the track */\n}\n\n.content form{\n    height: 100%;\n    width: 100%;\n\n    display: grid;\n    grid-template-columns: 1fr ;\n\n    padding: var(--extra-small-padding);\n    gap:var(--extra-small-padding);\n    box-sizing: border-box;\n\n}\n.step-left-side{\n\n    height: 100%;\n    width: 100%;\n\n    max-height: 100%;\n\n    display: flex;\n    flex-direction: column;\n    align-items: center;\n    justify-content: space-between;\n\n}\n.step-shell{\n    height: 100%;\n    width: 100%;\n    max-width: 100%;\n    overflow-x: auto;\n\n    border-radius: var(--extra-small-border-radius);\n\n    padding: var(--extra-small-padding);\n    box-sizing: border-box;\n}\n.step-shell::-webkit-scrollbar {\n  width: 4px; /* Width of the scrollbar */\n}\n\n/* Handle portion of the scrollbar */\n.step-shell::-webkit-scrollbar-thumb {\n  background-color: #999; /* Color of the thumb */\n  border-radius: 4px; /* Border radius of the thumb */\n}\n\n/* Track (background) of the scrollbar */\n.step-shell::-webkit-scrollbar-track {\n  background-color: #f0f0f0; /* Color of the track */\n}\n.step-footer{\n    height: 70px;\n    width: 100%;\n\n    color: var(--white-text-color );\n    padding: var(--extra-small-padding);\n    box-sizing: border-box;\n\n    border-radius: var(--extra-small-border-radius);\n\n    display: flex;\n    flex-direction: column;\n    justify-content: center;\n    align-items: space-between;\n\n    font-size: 14px;\n    text-align: left;\n\n    gap: 5px;\n\n    justify-self: flex-end;\n\n}\n.step-footer .shell-buttons{\n    width: 100%;\n    \n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n\n    gap: 5px;\n\n}\n\n.step-inputs{\n\n    font-size: 14px;\n\n    height: 100%;\n    width: 100%;\n\n    max-height: 100%;\n    overflow-y: auto;\n\n    box-sizing: border-box;\n}\n.step-inputs::-webkit-scrollbar {\n  width: 4px; /* Width of the scrollbar */\n}\n\n/* Handle portion of the scrollbar */\n.step-inputs::-webkit-scrollbar-thumb {\n  background-color: #999; /* Color of the thumb */\n  border-radius: 4px; /* Border radius of the thumb */\n}\n\n/* Track (background) of the scrollbar */\n.step-inputs::-webkit-scrollbar-track {\n  background-color: #f0f0f0; /* Color of the track */\n}\n\n\n@media only screen and (max-width: 1000px) {\n\n.execution-holder{\n    height: calc(100vh - var(--navbar-thin-height));\n}\n\n}\n\n\n\n\n</style>"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}